<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>night_horizons.image_processing.processors module &#8212; night-horizons-mapmaker 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=12dfc556" />
    <script src="_static/documentation_options.js?v=2709fde1"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="module-night_horizons.image_processing.processors">
<span id="night-horizons-image-processing-processors-module"></span><h1>night_horizons.image_processing.processors module<a class="headerlink" href="#module-night_horizons.image_processing.processors" title="Link to this heading">¶</a></h1>
<p>Module for processing a single “row”, aka a single image, in the context of
other images and metadata.</p>
<dl class="py class">
<dt class="sig sig-object py" id="night_horizons.image_processing.processors.DatasetProcessor">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">night_horizons.image_processing.processors.</span></span><span class="sig-name descname"><span class="pre">DatasetProcessor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">io_manager</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="night_horizons.io_manager.html#night_horizons.io_manager.IOManager" title="night_horizons.io_manager.IOManager"><span class="pre">IOManager</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_operator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="night_horizons.image_processing.operators.html#night_horizons.image_processing.operators.BaseImageOperator" title="night_horizons.image_processing.operators.BaseImageOperator"><span class="pre">BaseImageOperator</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_return_codes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_safe_process</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'uint8'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#night_horizons.image_processing.processors.DatasetProcessor" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#night_horizons.image_processing.processors.Processor" title="night_horizons.image_processing.processors.Processor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Processor</span></code></a></p>
<p>Class for operating on src images and a dataset from which we draw dst images.
Primary role is to be a parent class that enables shared functionality between
DatasetUpdater and DatasetScorer.</p>
<dl class="py method">
<dt class="sig sig-object py" id="night_horizons.image_processing.processors.DatasetProcessor.get_dst">
<span class="sig-name descname"><span class="pre">get_dst</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resources</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#night_horizons.image_processing.processors.DatasetProcessor.get_dst" title="Link to this definition">¶</a></dt>
<dd><p>Load an image from the dataset stored in resources, using the row’s
x_off, y_off, x_size, and y_size.</p>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>i<span class="classifier">int</span></dt><dd><p>Index of the current image.</p>
</dd>
<dt>row<span class="classifier">pd.Series</span></dt><dd><p>Series containing the metadata for the current image.</p>
</dd>
<dt>resources<span class="classifier">dict</span></dt><dd><p>Dictionary containing additional resources.</p>
</dd>
</dl>
</section>
<section id="returns">
<h2>Returns<a class="headerlink" href="#returns" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>dict</dt><dd><p>Results dictionary.</p>
</dd>
</dl>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="night_horizons.image_processing.processors.DatasetProcessor.get_image_from_dataset">
<span class="sig-name descname"><span class="pre">get_image_from_dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_off</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_off</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ndarray</span></span></span><a class="headerlink" href="#night_horizons.image_processing.processors.DatasetProcessor.get_image_from_dataset" title="Link to this definition">¶</a></dt>
<dd><p>Get an image from the dataset.</p>
<p>This method retrieves an image from the given dataset based on the specified
offset and size.</p>
<section id="id1">
<h2>Parameters<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>dataset<span class="classifier">gdal.Dataset</span></dt><dd><p>The GDAL dataset from which to retrieve the image.</p>
</dd>
<dt>x_off<span class="classifier">int</span></dt><dd><p>The x-coordinate offset of the image within the dataset.</p>
</dd>
<dt>y_off<span class="classifier">int</span></dt><dd><p>The y-coordinate offset of the image within the dataset.</p>
</dd>
<dt>x_size<span class="classifier">int</span></dt><dd><p>The width of the image.</p>
</dd>
<dt>y_size<span class="classifier">int</span></dt><dd><p>The height of the image.</p>
</dd>
</dl>
</section>
<section id="id2">
<h2>Returns<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>numpy.ndarray</dt><dd><p>The image as a NumPy array.</p>
</dd>
</dl>
</section>
<section id="raises">
<h2>Raises<a class="headerlink" href="#raises" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>AssertionError</dt><dd><p>If the specified offsets and sizes are out of bounds of the dataset.</p>
</dd>
</dl>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="night_horizons.image_processing.processors.DatasetProcessor.get_src">
<span class="sig-name descname"><span class="pre">get_src</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resources</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#night_horizons.image_processing.processors.DatasetProcessor.get_src" title="Link to this definition">¶</a></dt>
<dd><p>Load an image using the “filepath” column of the metadata.</p>
<section id="id3">
<h2>Parameters<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>i<span class="classifier">int</span></dt><dd><p>Index of the current image.</p>
</dd>
<dt>row<span class="classifier">pd.Series</span></dt><dd><p>Series containing the metadata for the current image.</p>
</dd>
<dt>resources<span class="classifier">dict</span></dt><dd><p>Dictionary containing additional resources.</p>
</dd>
</dl>
</section>
<section id="id4">
<h2>Returns<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>dict</dt><dd><p>Results dictionary.</p>
</dd>
</dl>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="night_horizons.image_processing.processors.DatasetProcessor.save_image_to_dataset">
<span class="sig-name descname"><span class="pre">save_image_to_dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">img</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_off</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_off</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#night_horizons.image_processing.processors.DatasetProcessor.save_image_to_dataset" title="Link to this definition">¶</a></dt>
<dd><p>Save an image to a gdal Dataset.</p>
<section id="id5">
<h2>Parameters<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>dataset<span class="classifier">gdal.Dataset</span></dt><dd><p>The GDAL dataset from which to retrieve the image.</p>
</dd>
<dt>img<span class="classifier">np.ndarray</span></dt><dd><p>The image to save.</p>
</dd>
<dt>x_off<span class="classifier">int</span></dt><dd><p>The x-coordinate offset of the image within the dataset.</p>
</dd>
<dt>y_off<span class="classifier">int</span></dt><dd><p>The y-coordinate offset of the image within the dataset.</p>
</dd>
</dl>
</section>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="night_horizons.image_processing.processors.DatasetUpdater">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">night_horizons.image_processing.processors.</span></span><span class="sig-name descname"><span class="pre">DatasetUpdater</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">io_manager</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="night_horizons.io_manager.html#night_horizons.io_manager.IOManager" title="night_horizons.io_manager.IOManager"><span class="pre">IOManager</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_operator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="night_horizons.image_processing.operators.html#night_horizons.image_processing.operators.BaseImageOperator" title="night_horizons.image_processing.operators.BaseImageOperator"><span class="pre">BaseImageOperator</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_return_codes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_safe_process</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'uint8'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#night_horizons.image_processing.processors.DatasetUpdater" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#night_horizons.image_processing.processors.DatasetProcessor" title="night_horizons.image_processing.processors.DatasetProcessor"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatasetProcessor</span></code></a></p>
<p>Class for updating a dataset based on the provided image.</p>
<dl class="py method">
<dt class="sig sig-object py" id="night_horizons.image_processing.processors.DatasetUpdater.process">
<span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resources</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">src</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dst</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#night_horizons.image_processing.processors.DatasetUpdater.process" title="Link to this definition">¶</a></dt>
<dd><p>Processing for the dataset updater.</p>
<section id="id6">
<h2>Parameters<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>i<span class="classifier">int</span></dt><dd><p>Index of the current image.</p>
</dd>
<dt>row<span class="classifier">pd.Series</span></dt><dd><p>Series containing the metadata for the current image.</p>
</dd>
<dt>resources<span class="classifier">dict</span></dt><dd><p>Dictionary containing additional resources.</p>
</dd>
<dt>src:</dt><dd><p>Dictionary containing source image and parameters.</p>
</dd>
<dt>dst:</dt><dd><p>Dictionary containing destination image and parameters.</p>
</dd>
</dl>
</section>
<section id="id7">
<h2>Returns<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>dict</dt><dd><p>Results dictionary.</p>
</dd>
</dl>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="night_horizons.image_processing.processors.DatasetUpdater.store_results">
<span class="sig-name descname"><span class="pre">store_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resources</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">results</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Series</span></span></span><a class="headerlink" href="#night_horizons.image_processing.processors.DatasetUpdater.store_results" title="Link to this definition">¶</a></dt>
<dd><p>Store results, i.e. update the dataset.</p>
<section id="id8">
<h2>Parameters<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>i<span class="classifier">int</span></dt><dd><p>Index of the current image.</p>
</dd>
<dt>row<span class="classifier">pd.Series</span></dt><dd><p>Series containing the metadata for the current image.</p>
</dd>
<dt>resources<span class="classifier">dict</span></dt><dd><p>Dictionary containing additional resources.</p>
</dd>
<dt>results:</dt><dd><p>Results dictionary to store.</p>
</dd>
</dl>
</section>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="night_horizons.image_processing.processors.Processor">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">night_horizons.image_processing.processors.</span></span><span class="sig-name descname"><span class="pre">Processor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">io_manager</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="night_horizons.io_manager.html#night_horizons.io_manager.IOManager" title="night_horizons.io_manager.IOManager"><span class="pre">IOManager</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_operator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="night_horizons.image_processing.operators.html#night_horizons.image_processing.operators.BaseImageOperator" title="night_horizons.image_processing.operators.BaseImageOperator"><span class="pre">BaseImageOperator</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_return_codes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_safe_process</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#night_horizons.image_processing.processors.Processor" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="night_horizons.utils.html#night_horizons.utils.LoggerMixin" title="night_horizons.utils.LoggerMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">LoggerMixin</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ABC</span></code></p>
<p>Processor is an abstract class that defines the structure of a processor.</p>
<p>This could probably be framed as an sklearn estimator too, but let’s
not do that until necessary.</p>
<dl class="py method">
<dt class="sig sig-object py" id="night_horizons.image_processing.processors.Processor.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch_processor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="night_horizons.image_processing.batch.html#night_horizons.image_processing.batch.BatchProcessor" title="night_horizons.image_processing.batch.BatchProcessor"><span class="pre">BatchProcessor</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#night_horizons.image_processing.processors.Processor" title="night_horizons.image_processing.processors.Processor"><span class="pre">Processor</span></a></span></span><a class="headerlink" href="#night_horizons.image_processing.processors.Processor.fit" title="Link to this definition">¶</a></dt>
<dd><p>Copy over fit values from the batch processor.</p>
<p>This method copies over fit values from the given batch processor to
the current instance.
It iterates through all attributes of the batch processor and checks if
the attribute name ends with an underscore, indicating that it is a
fit variable. If so, it copies the attribute value to the current instance.</p>
<section id="id9">
<h2>Parameters<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>batch_processor<span class="classifier">BatchProcessor</span></dt><dd><p>The batch processor from which to copy the fit values.</p>
</dd>
</dl>
</section>
<section id="id10">
<h2>Returns<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>self<span class="classifier">Processor</span></dt><dd><p>The current instance with the fit values copied over.</p>
</dd>
</dl>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="night_horizons.image_processing.processors.Processor.get_dst">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_dst</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resources</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#night_horizons.image_processing.processors.Processor.get_dst" title="Link to this definition">¶</a></dt>
<dd><p>Abstract base method for getting the destination image.</p>
<section id="id11">
<h2>Parameters<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>i<span class="classifier">int</span></dt><dd><p>Index of the current image.</p>
</dd>
<dt>row<span class="classifier">pd.Series</span></dt><dd><p>Series containing the metadata for the current image.</p>
</dd>
<dt>resources<span class="classifier">dict</span></dt><dd><p>Dictionary containing additional resources.</p>
</dd>
</dl>
</section>
<section id="id12">
<h2>Returns<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>dict</dt><dd><p>Results dictionary.</p>
</dd>
</dl>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="night_horizons.image_processing.processors.Processor.get_src">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_src</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resources</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#night_horizons.image_processing.processors.Processor.get_src" title="Link to this definition">¶</a></dt>
<dd><p>Abstract base method for getting the source image.</p>
<section id="id13">
<h2>Parameters<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>i<span class="classifier">int</span></dt><dd><p>Index of the current image.</p>
</dd>
<dt>row<span class="classifier">pd.Series</span></dt><dd><p>Series containing the metadata for the current image.</p>
</dd>
<dt>resources<span class="classifier">dict</span></dt><dd><p>Dictionary containing additional resources.</p>
</dd>
</dl>
</section>
<section id="id14">
<h2>Returns<a class="headerlink" href="#id14" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>dict</dt><dd><p>Results dictionary.</p>
</dd>
</dl>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="night_horizons.image_processing.processors.Processor.process">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resources</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">src</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dst</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#night_horizons.image_processing.processors.Processor.process" title="Link to this definition">¶</a></dt>
<dd><p>Abstract base method for main processing function.</p>
<section id="id15">
<h2>Parameters<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>i<span class="classifier">int</span></dt><dd><p>Index of the current image.</p>
</dd>
<dt>row<span class="classifier">pd.Series</span></dt><dd><p>Series containing the metadata for the current image.</p>
</dd>
<dt>resources<span class="classifier">dict</span></dt><dd><p>Dictionary containing additional resources.</p>
</dd>
<dt>src:</dt><dd><p>Dictionary containing source image and parameters.</p>
</dd>
<dt>dst:</dt><dd><p>Dictionary containing destination image and parameters.</p>
</dd>
</dl>
</section>
<section id="id16">
<h2>Returns<a class="headerlink" href="#id16" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>dict</dt><dd><p>Results dictionary.</p>
</dd>
</dl>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="night_horizons.image_processing.processors.Processor.process_row">
<span class="sig-name descname"><span class="pre">process_row</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resources</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Series</span></span></span><a class="headerlink" href="#night_horizons.image_processing.processors.Processor.process_row" title="Link to this definition">¶</a></dt>
<dd><p>Process one image, with metadata stored in row and other context in
resources.</p>
<p>Generally speaking, src refers to our new data, and dst refers to
the existing data (including if the existing data was just updated
with src in a previous row).</p>
<p>A better name than “process_row” may be available. process_row is not
100% desirable since we don’t clarify what a row is..</p>
<section id="id17">
<h2>Parameters<a class="headerlink" href="#id17" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>i<span class="classifier">int</span></dt><dd><p>The index of the image being processed.</p>
</dd>
<dt>row<span class="classifier">pd.Series</span></dt><dd><p>The metadata of the image being processed, including the filename.</p>
</dd>
<dt>resources<span class="classifier">dict</span></dt><dd><p>Additional context and resources for the image processing.</p>
</dd>
</dl>
</section>
<section id="id18">
<h2>Returns<a class="headerlink" href="#id18" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>pd.Series</dt><dd><p>The updated metadata of the image after processing.</p>
</dd>
</dl>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="night_horizons.image_processing.processors.Processor.safe_process">
<span class="sig-name descname"><span class="pre">safe_process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resources</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">src</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dst</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#night_horizons.image_processing.processors.Processor.safe_process" title="Link to this definition">¶</a></dt>
<dd><p>Same as process, but catching anticipated errors.</p>
<section id="id19">
<h2>Parameters<a class="headerlink" href="#id19" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>i<span class="classifier">int</span></dt><dd><p>Index of the current image.</p>
</dd>
<dt>row<span class="classifier">pd.Series</span></dt><dd><p>Series containing the metadata for the current image.</p>
</dd>
<dt>resources<span class="classifier">dict</span></dt><dd><p>Dictionary containing additional resources.</p>
</dd>
<dt>src<span class="classifier">np.ndarray</span></dt><dd><p>Source image.</p>
</dd>
<dt>dst<span class="classifier">np.ndarray</span></dt><dd><p>Destination image.</p>
</dd>
</dl>
</section>
<section id="id20">
<h2>Returns<a class="headerlink" href="#id20" title="Link to this heading">¶</a></h2>
<dl>
<dt>results<span class="classifier">dict</span></dt><dd><p>Dictionary containing the results of the processing.
Possible keys:
- blended_img: Combined image. Not always returned.
- M: Homography transform. Not always returned.
- src_kp: Keypoints for the src image. Not always returned.
- src_des: KP descriptors for the src image. Not always returned.
- duration: Time spent.
- return_code: Code indicating the outcome of the processing.</p>
<blockquote>
<div><p>Possible values:
- ‘success’: Processing completed successfully.
- ‘opencv_err’: OpenCV error occurred.
- ‘bad_det’: Homography transform error occurred.
- ‘dark_frame’: Src dark frame error occurred.
- ‘dst_dark_frame’: Dst dark frame error occurred.
- ‘linalg_err’: Linear algebra error occurred.
- ‘out_of_bounds’: Out of bounds error occurred.</p>
</div></blockquote>
</dd>
</dl>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="night_horizons.image_processing.processors.Processor.store_results">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">store_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resources</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">results</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Series</span></span></span><a class="headerlink" href="#night_horizons.image_processing.processors.Processor.store_results" title="Link to this definition">¶</a></dt>
<dd><p>Abstract base method for storing results.</p>
<section id="id21">
<h2>Parameters<a class="headerlink" href="#id21" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>i<span class="classifier">int</span></dt><dd><p>Index of the current image.</p>
</dd>
<dt>row<span class="classifier">pd.Series</span></dt><dd><p>Series containing the metadata for the current image.</p>
</dd>
<dt>resources<span class="classifier">dict</span></dt><dd><p>Dictionary containing additional resources.</p>
</dd>
<dt>results:</dt><dd><p>Dictionary containing output of processing.</p>
</dd>
</dl>
</section>
<section id="id22">
<h2>Returns<a class="headerlink" href="#id22" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>pd.Series</dt><dd><p>Metadata for the processed image.</p>
</dd>
</dl>
</section>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="night_horizons.image_processing.processors.ReferencerDatasetUpdater">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">night_horizons.image_processing.processors.</span></span><span class="sig-name descname"><span class="pre">ReferencerDatasetUpdater</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">io_manager</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="night_horizons.io_manager.html#night_horizons.io_manager.IOManager" title="night_horizons.io_manager.IOManager"><span class="pre">IOManager</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_operator</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="night_horizons.image_processing.operators.html#night_horizons.image_processing.operators.BaseImageOperator" title="night_horizons.image_processing.operators.BaseImageOperator"><span class="pre">BaseImageOperator</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_return_codes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_safe_process</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'uint8'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#night_horizons.image_processing.processors.ReferencerDatasetUpdater" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#night_horizons.image_processing.processors.DatasetUpdater" title="night_horizons.image_processing.processors.DatasetUpdater"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatasetUpdater</span></code></a></p>
<p>Class for not just updating the dataset, but also saving now-referenced
images based on the processing done.</p>
<dl class="py method">
<dt class="sig sig-object py" id="night_horizons.image_processing.processors.ReferencerDatasetUpdater.store_results">
<span class="sig-name descname"><span class="pre">store_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resources</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">results</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#night_horizons.image_processing.processors.ReferencerDatasetUpdater.store_results" title="Link to this definition">¶</a></dt>
<dd><p>Store results, i.e. update the dataset and save a referenced image.</p>
<section id="id23">
<h2>Parameters<a class="headerlink" href="#id23" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>i<span class="classifier">int</span></dt><dd><p>Index of the current image.</p>
</dd>
<dt>row<span class="classifier">pd.Series</span></dt><dd><p>Series containing the metadata for the current image.</p>
</dd>
<dt>resources<span class="classifier">dict</span></dt><dd><p>Dictionary containing additional resources.</p>
</dd>
<dt>results:</dt><dd><p>Results dictionary to store.</p>
</dd>
</dl>
</section>
</dd></dl>

</dd></dl>

</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">night-horizons-mapmaker</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data-flow.html">Data flow</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Zachary Hafen-Saavedra.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/night_horizons.image_processing.processors.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>